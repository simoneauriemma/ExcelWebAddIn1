<html>

    <head>
        <meta charset="utf-8">

        <link href="../../COMPONENTS/datalets/base-datalet/static/css/all.min.css" rel="stylesheet">
        <link href="../../COMPONENTS/datalets/base-datalet/static/css/baloon.min.css" rel="stylesheet">

        <link rel='shortcut icon' type='image/x-icon' href='../../COMPONENTS/datalets/base-datalet/static/images/rtpalogo.png' />

        <script src="../../COMPONENTS/datalets/lib/vendors/webcomponents_polyfill_ff/webcomponents-hi-sd-ce.js"></script>
        <script type="text/javascript" src="../../COMPONENTS/bower_components/webcomponentsjs/webcomponents-lite.js"></script>
        <script type="text/javascript" src="../../DEEPCLIENT/js/jquery-2.1.0.min.js"></script>
        <link rel="import" href="../../COMPONENTS/controllets/co-datalets-creator-controllet/co-datalets-creator-controllet.html">

<!--        <script type="text/javascript" src="../creator/datasets.js"></script>-->
        <script type="text/javascript" src="../creator/creator.js"></script>
        <script type="text/javascript" src="../creator/creator_from.js"></script>
        <link href="regione_calabria/rc_creator.css" rel="stylesheet">

        <script>

            $(function () {

                CREATOR_FROM.injectHTML  = function(ln, datasets) {
                    let url_string = window.location.href;
                    let url = new URL(url_string);
                    let dataUrl = url.searchParams.get("data-url");
                    let limit = url.searchParams.get("limit");

                    if(limit)
                        dataUrl += '&limit=' + limit;

                    $("body").append(
                        '<co-datalets-creator-controllet'+
                        ' id="controllet"'+
                        ' components-url="../../COMPONENTS/"'+ 
                        ' deep-url="../../DEEP/"'+
                        ' datalets-list-url="../../DEEP/datalets-list"'+
                        ' data-url="'+ dataUrl + '"'+
                        ' localization="'+ ln + '">'+
                        '</co-datalets-creator-controllet>'
                    );
                };

                let ln = CREATOR.ln();
                CREATOR_FROM.injectHTML(ln);
                CREATOR_FROM.init();
                CREATOR_FROM.setListeners();

                /****
                 * [DEEP_URL]/COMPONENTS/creator/regione_calabria-from.html?
                 * ln=it
                 * &data-url=[CKAN_URL]/api/3/action/datastore_search?resource_id=[RESOURCE_ID]
                 * &limit=99999
                 * e.g. --> http://deep.regione.campania.it/deep2/COMPONENTS/creator_from.html?ln=it&data-url=https://dati.regione.campania.it/ckan/api/3/action/datastore_search?resource_id=abc2bf6f-befb-4eba-9e15-f27b44c1e959%26&limit=99999
                 ****/
            });

            $( document ).ready(function() {
                setTimeout(() => {
                    CREATOR.translate();
                }, 1000);
            });

        </script>

    </head>

    <body>

        <div class="outside">
            <button class="outside" id="btn_share" data-balloon="" data-balloon-pos="down"><i class="fas fa-share-alt"></i></button>
            <button class="outside" id="btn_download" data-balloon="" data-balloon-pos="down"><i class="fas fa-download"></i></button>
            <button class="outside" id="btn_embed" data-balloon="" data-balloon-pos="down"><i class="fas fa-code"></i></button>
            <button class="outside" id="btn_fullscreen" data-balloon="" data-balloon-pos="down"><i class="fas fa-expand"></i></button>
        </div>

        <div id="download-modal" class="sm-modal">
            <div class="sm-modal-content">
                <div class="sm-modal-close">&times;</div>
                <div id="btn_png" class="action"></div>
                <div id="btn_doc" class="action"></div>
                <div id="btn_csv" class="action"></div>
                <!--<div id="btn_csv" class="action">Salva dataset completo (.csv)</div>-->
                <!--<div id="btn_fcsv" class="action">Salva dataset filtrato (.csv)</div>-->
                <!--<div id="btn_close" class="action">Servizio non disponibile per questa Datalet</div>-->
            </div>
        </div>

        <div id="share-modal" class="sm-modal">
            <div class="sm-modal-content">
                <div class="sm-modal-close">&times;</div>
                <div id="btn_fb" class="action"><i class="fab fa-facebook-square"></i> <span id="label_fb"></span></div>
                <div id="btn_tw" class="action"><i class="fab fa-twitter-square"></i> <span id="label_tw"></span></div>
                <div id="btn_li" class="action"><i class="fab fa-linkedin"></i> <span id="label_li"></span></div>
                <div id="btn_pn" class="action"><i class="fab fa-pinterest-square"></i> <span id="label_pn"></span></div>
                <div id="btn_ml" class="action"><i class="fas fa-envelope-square"></i> <span id="label_ml"></span></div>
            </div>
        </div>

    </body>

</html>